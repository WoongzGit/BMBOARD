<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>BMBoard</title>

    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">

    <link href="/bmboard/css/bootstrap/bootstrap.min.css" rel="stylesheet">
    
  </head>
  <body>
    <div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<nav class="navbar navbar-expand-lg navbar-light bg-light navbar-dark bg-dark static-top">
					 
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="navbar-toggler-icon"></span>
					</button> <a class="navbar-brand" href="#" id="test">BMBoard</a>
					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="navbar-nav">
							<li class="nav-item">
								<a class="nav-link" href="/bmboard/news/list.html">Hacker's News</a>
							</li>
							<li class="nav-item active">
								<a class="nav-link" href="/bmboard/board/list.html">Boards <span class="sr-only">(current)</span></a>
							</li>
						</ul>
						<ul class="navbar-nav ml-md-auto">
							<li class="nav-item">
								<a class="nav-link" href="/bmboard/mypage/view.html">myPage</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">Logout</a>
							</li>
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="javascript:void(0);" id="navbarDropdownMenuLink" data-toggle="dropdown">Login</a>
								<div class="dropdown-menu dropdown-menu-right">
									<form class="px-4 py-3">
									<div class="form-group">
										<label for="exampleDropdownFormEmail1">Email address</label>
										<input type="email" class="form-control" id="exampleDropdownFormEmail1" placeholder="email@example.com">
									</div>
									<div class="form-group">
										<label for="exampleDropdownFormPassword1">Password</label>
										<input type="password" class="form-control" id="exampleDropdownFormPassword1" placeholder="Password">
									</div>
									<div class="form-check">
										<input type="checkbox" class="form-check-input" id="dropdownCheck">
										<label class="form-check-label" for="dropdownCheck">
										Remember me
										</label>
									</div>
									<button type="submit" class="btn btn-primary">Sign in</button>
									</form>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#">New around here? Sign up</a>
									<a class="dropdown-item" href="#">Forgot password?</a>
								</div>
							</li>
						</ul>
					</div>
				</nav>
				<div class="jumbotron">
					<h2>
						안녕, 게시판!
					</h2>
					<p>
						게시판을 선택해 게시물을 올려보아요!
					</p>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<nav class="border-bottom mb-5">
					<ul class="pagination justify-content-center" id="boardNav">
						<li class="page-item">
							<a class="page-link" href="#">Previous</a>
						</li>
						<li class="page-item">
							<a class="page-link" href="#">1</a>
						</li>
						<li class="page-item">
							<a class="page-link" href="#">Next</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
					<h1 class="h2" id="spanBoardTitle">사용자 관리</h1>
					<div class="btn-toolbar mb-2 mb-md-0">
						<div class="btn-group mr-2">
							<button type="button" class="btn btn-sm btn-outline-success" id="buttonRegister">
							<span data-feather="plus-square"></span>
							글 작성
							</button>
						</div>
					</div>
				</div>
				<table class="table table-hover table-sm" id="postTable">
					<thead>
						<tr>
							<th>
								제목
							</th>
							<th>
								작성자
							</th>
							<th>
								조회수
							</th>
							<th>
								작성일
							</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
				<nav aria-label="Page navigation example">
					<ul id="pagination" class="pagination justify-content-center">
					</ul>
				</nav>
			</div>
		</div>
	</div>
	
	<form method="POST" action="/bmboard/post/view.html" id="formView">
		<input type="hidden" id="csrf" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
		<input type="hidden" id="boardPageNum" th:name="boardPageNum" th:value="${boardPageNum}"/>
		<input type="hidden" id="boardPageSize" th:name="boardPageSize" th:value="${boardPageSize}"/>
		<input type="hidden" id="postPageNum" th:name="postPageNum" th:value="${postPageNum}"/>
		<input type="hidden" id="postPageSize" th:name="postPageSize" th:value="${postPageSize}"/>
		<input type="hidden" id="boardIdx" th:name="boardIdx" th:value="${boardIdx}"/>
		<input type="hidden" id="postIdx" th:name="postIdx" th:value="${postIdx}"/>
		<input type="submit"/> 
	</form>

    <script src="/bmboard/js/jquery/jquery.min.js"></script>
    <script src="/bmboard/js/bootstrap/bootstrap.min.js"></script>
    <script src="/bmboard/js/dashboard/commons.js"></script>
    <script src="/bmboard/js/dashboard/feather.min.js"></script>
    <script src="/bmboard/js/jquery/jquery.twbsPagination.js"></script>
    <script>
	    $(document).ready(function(){
			var boardPageNum = 0; // 게시판 페이징 현재 페이지 번호
			var boardEleCnt = 0; // 게시판 element 개수
			var boardPageSize = 5; // 게시판 페이징 페이지 사이즈
			var boardIdx = 0; // 게시판 번호
			var postPageSize = 10; // 게시물 페이지 사이즈
			var postPageNum = 0; // 게시물 페이징 현재 페이지 번호
			var pageInit = function(){
				// 게시판 리스트 조회
				getBoardList(true);
			};
			
			/* 모든 게시판의 데이터 조회
			   isClickFirst : 탭 목록 조회 시 최초 클릭할 탭 설정 (true : 첫번째, false : 마지막 탭)
			*/
			var getBoardList = function(isClickFirst){
				var url = "/bmboard/boards";
				var type = "GET";
				var data = {
					  pageNum:boardPageNum
					, pageSize:boardPageSize
					, _csrf:$('#csrf').val()
				}
				var onParam = {
					  isClickFirst:isClickFirst
				}
				
				getList(url, type, data, viewBoardList, onParam, false);
			}
			
			/* 모든 게시판의 데이터 조회
			   boardIdx : 조회할 게시판
			   pageNum : 조회할 게시판, 게시물의 페이지 번호
			   pagingInit : 게시물 페이징 초기화 여부 (true : 초기화, false : 초기화하지 않음)
			*/
			var getPostList = function(pagingInit){
				var url = "/bmboard/posts";
				var type = "POST";
				var data = {
					  pageNum:postPageNum
					, pageSize:postPageSize
					, boardIdx:boardIdx
					, _csrf:$('#csrf').val()
				}
				var onParam = {
					  pagingInit:pagingInit
				};
				
				getList(url, type, data, viewPostList, onParam, false);
			}
			
			/* 게시판 데이터 nav 추가
			   data : 게시물 데이터
			   onParam : getList 메소드 성공시 전달하는 파라미터
			*/
			var viewBoardList = function(data, onParam){
				console.log(data);
				$("#boardNav").children().remove();
				
				var html = "";
				html += '<li class="page-item"><a class="page-link" href="#"><span data-feather="arrow-left" width="15" height="15"></span></a></li>';
				for(var i = 0; i < data.numberOfElements; i++){
					html += '<li class="page-item" data="' + data.content[i].boardIdx + '"><a class="page-link" href="#"><span class="text-truncate" style="max-width:150px;height:20px;" title="' + data.content[i].boardName + '">' + data.content[i].boardName + '</span></a></li>';
				}
				html += '<li class="page-item"><a class="page-link" href="#"><span data-feather="arrow-right" width="15" height="15"></span></a></li>';
				
				$("#boardNav").html(html);
				
				feather.replace();
				
				boardEleCnt = data.totalElements;
				
				if(onParam.isClickFirst){
					$("#boardNav li:eq(1)").click();
				}else{
					$("#boardNav li:eq(" + ($("#boardNav li").length - 2) + ")").click();
				}
			}
				
			/* 게시판 탭 클릭 메소드 */
			$(document).on("click", "#boardNav li", function(){
				var _boardNav = $('#boardNav');
				var idx = $(this).index();
				var activeIdx = _boardNav.find(".active").index();
				var liCnt = _boardNav.find('li').length - 1;
				var onParam = null;
				
				if(idx == 0){
					// 이전
					if(!$(this).hasClass("disabled")){
   					if(activeIdx - 1 <= 0){
   						if(boardPageNum - 1 >= 0) {
   							boardPageNum -= 1;
   							
   							getBoardList(false);
   						}
   					}else{
   						activeIdx -= 1;
   						_boardNav.find('li:eq(' + activeIdx + ')').click();
   					}
					}
				}else if(idx == liCnt){
					// 다음
					if(!$(this).hasClass("disabled")){
   					if(activeIdx + 1 >= liCnt){
   						if(boardPageNum + 1 < Math.ceil(boardEleCnt / boardPageSize)) {
   							boardPageNum += 1;
   							
   							getBoardList(true);
   						}
   					}else{
   						activeIdx += 1;
   						_boardNav.find('li:eq(' + activeIdx + ')').click();
   					}
					}
				}else{
					_boardNav.find('li').removeClass("active");
					$(this).addClass("active");
					// 이전 화살표 disable 처리
					if(boardPageNum == 0 && idx == 1){
						_boardNav.find('li:eq(0)').addClass("disabled");
					}else{
						_boardNav.find('li:eq(0)').removeClass("disabled");
					}
					
					// 다음 화살표 disable 처리
					if(boardEleCnt == (boardPageNum * boardPageSize + idx)){
						_boardNav.find('li:eq(' + (liCnt) + ')').addClass("disabled");
					}else{
						_boardNav.find('li:eq(' + (liCnt) + ')').removeClass("disabled");
					}
					
					$('#spanBoardTitle').text($(this).text());
					
					boardIdx = $(this).attr("data");
					
					postPageNum = 0;
					
					getPostList(true);
				}
			});
			
			/* 게시물 데이터 테이블 추가
			   data : 게시물 데이터
			   onParam : getList 메소드 성공시 전달하는 파라미터
			*/
			var viewPostList = function(data, onParam){
				$("#postTable tbody").children().remove();
					
					var html = "";
					for(var i = 0; i < data.numberOfElements; i++){
					html += "<tr>";
					html += "<td><a href='#' class='text-decoration-none d-inline-block text-truncate' id='goView' data='" + data.content[i].postIdx + "' style='max-width: 300px;' title='" + data.content[i].postTitle + "'>";
					html += data.content[i].postTitle + "</a></td>";
					html += "<td><span class='d-inline-block text-truncate' style='max-width: 150px;' title='" + data.content[i].email + "'>";
					html += data.content[i].memberEntity.email + "</span></td>";
					html += "<td>" + data.content[i].postCnt + "</td>";
					html += "<td>" + data.content[i].regDate.substr(0, 10) + "</td>";
					html += "</tr>";
					}
					
					$("#postTable tbody").html(html);
	
		    	if(onParam.pagingInit){
		    		pagination(data.totalPages);
		    	}
					
					feather.replace();
			};
			
			/* 게시물 데이터 페이징
			   resultPages : 게시물 데이터 페이징 총 페이지 수
			*/
			var pagination = function(resultPages){
				console.log("resultPages : " + resultPages);
				var totalPages = resultPages;
				
				// 게시물이 없는 게시판일 경우 resultPages == 0 이면 pagination 생성 시 에러 발생으로 초기값 1을 설정
				if(totalPages <= 0){
					totalPages = 1;
				}
				
				$('#pagination').twbsPagination({
		            totalPages: totalPages,
		            visiblePages: postPageSize,
		            onPageClick: function (event, page) {
		                console.info(page + ' (from options)');
		            }
		        }).on('page', function (event, page) {
		        	postPageNum = page - 1;
		        	getPostList(false);
		            console.info(page + ' (from event listening)');
		        });
			};
			

			/* 게시글 작성 페이지 이동 */
			$(document).on("click", "#buttonRegister", function(){
				$('#boardIdx').val(boardIdx);
				$('#formView').attr("action", "/bmboard/post/new.html");
				
				$('#formView').submit();
			});
			
			/* 게시글 상세보기 페이지 이동 */
			$(document).on("click", "#goView", function(){
				$('#boardIdx').val(boardIdx);
				$('#postIdx').val($(this).attr('data'));
				$('#boardPageNum').val(boardPageNum);
				$('#boardPageSize').val(boardPageSize);
				$('#postPageNum').val(postPageNum);
				$('#postPageSize').val(postPageSize);
				$('#formView').attr("action", "/bmboard/post/view.html");
				
				$('#formView').submit();
			});
			
			// 화면 초기화
			pageInit();
		});
    </script>
  </body>
</html>